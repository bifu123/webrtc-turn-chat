<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>TURN å›ºå®šç”¨æˆ·åæµ‹è¯•</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    pre { background: #f0f0f0; padding: 10px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
  <h2>æµ‹è¯• TURN ä¸­ç»§ï¼ˆå›ºå®šç”¨æˆ·åï¼‰</h2>
  <pre id="log">ğŸŸ¡ æ­£åœ¨ç”Ÿæˆå€™é€‰...</pre>

  <script>
    const log = (msg) => {
      console.log(msg);
      const logEl = document.getElementById("log");
      logEl.textContent += "\n" + msg;
      logEl.scrollTop = logEl.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
    };

    const pc = new RTCPeerConnection({
      iceServers: [
        {
          urls: "turn:" + location.hostname + ":3478",  // ä¿®æ”¹ä¸ºä½ çš„ TURN æœåŠ¡å™¨ IP
          username: "webrtcuser",          // ä¸ turnserver.conf ä¸­ä¿æŒä¸€è‡´
          credential: "123456"             // ä¸ turnserver.conf ä¸­ä¿æŒä¸€è‡´
        }
      ],
      iceTransportPolicy: "relay"  // å¼ºåˆ¶åªç”¨ TURN ä¸­ç»§ï¼Œä¾¿äºæµ‹è¯•
    });

    // åˆ›å»ºæ•°æ®é€šé“ï¼Œæ‰èƒ½å¯åŠ¨ ICE è¿‡ç¨‹
    const dc = pc.createDataChannel("test");

    pc.onicecandidate = (event) => {
      if (event.candidate) {
        const c = event.candidate.candidate;
        log("ğŸ“¡ ICE candidate: " + c);
        if (c.includes("relay")) {
          log("âœ… æˆåŠŸä½¿ç”¨ TURN ä¸­ç»§ï¼");
        }
      } else {
        log("ğŸŸ¢ æ‰€æœ‰å€™é€‰å·²æ”¶é›†å®Œæ¯•");
      }
    };

    pc.createOffer()
      .then(offer => pc.setLocalDescription(offer))
      .catch(err => log("âŒ åˆ›å»º offer å‡ºé”™: " + err));
  </script>
</body>
</html>
